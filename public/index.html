<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Room Lobby</title>
  <script src="/socket.io/socket.io.js"></script>
  <style>
    body { font-family: Arial; text-align: center; background: #f5f5f5; }
    #lobby, #game { display: none; }
    .playerBox { border: 1px solid #333; padding: 10px; margin: 5px; display: inline-block; background: #fff; }
    .ownerTag { color: red; font-weight: bold; }
  </style>
</head>
<body>
  <h1>Game Lobby</h1>

  <div id="menu">
    <input id="playerName" placeholder="Your name"><br><br>
    <button id="createBtn">Create Room</button>
    <br><br>
    <input id="roomCode" placeholder="Room code">
    <button id="joinBtn">Join Room</button>
  </div>

  <div id="lobby">
    <h2>Room Code: <span id="roomDisplay"></span></h2>
    <div id="players"></div>
    <button id="startBtn" style="display:none;">Start Game</button>
  </div>

  <script>
    const socket = io();
    let roomCode = null;
    let isOwner = false;

    document.getElementById("createBtn").onclick = () => {
      const name = document.getElementById("playerName").value.trim();
      if (!name) return alert("Enter a name");

      socket.emit("createRoom", name, (res) => {
        if (res.success) {
          roomCode = res.code;
          isOwner = true;
          enterLobby();
        }
      });
    };

    document.getElementById("joinBtn").onclick = () => {
      const name = document.getElementById("playerName").value.trim();
      const code = document.getElementById("roomCode").value.trim().toUpperCase();
      if (!name || !code) return alert("Enter name and code");

      socket.emit("joinRoom", { code, name }, (res) => {
        if (res.success) {
          roomCode = res.code;
          isOwner = false;
          enterLobby();
        } else {
          alert(res.message);
        }
      });
    };

    function enterLobby() {
      document.getElementById("menu").style.display = "none";
      document.getElementById("lobby").style.display = "block";
      document.getElementById("roomDisplay").innerText = roomCode;
      if (isOwner) {
        document.getElementById("startBtn").style.display = "block";
      }
    }

    socket.on("updatePlayers", (players) => {
      const container = document.getElementById("players");
      container.innerHTML = "";
      for (const id in players) {
        const box = document.createElement("div");
        box.className = "playerBox";
        box.innerHTML = players[id].name + (id === socket.id ? " (You)" : "");
        if (isOwner && id !== socket.id) {
          const kickBtn = document.createElement("button");
          kickBtn.innerText = "Kick";
          kickBtn.onclick = () => socket.emit("kickPlayer", { code: roomCode, targetId: id });
          box.appendChild(document.createElement("br"));
          box.appendChild(kickBtn);
        }
        if (id === Object.keys(players)[0]) {
          box.innerHTML += " <span class='ownerTag'>(Owner)</span>";
        }
        container.appendChild(box);
      }
    });

    document.getElementById("startBtn").onclick = () => {
      socket.emit("startGame", roomCode);
    };

    socket.on("gameStarted", (players) => {
      window.location.href = "/game.html?code=" + roomCode;
    });

    socket.on("kicked", () => {
      alert("You were kicked");
      window.location.reload();
    });

    socket.on("roomClosed", () => {
      alert("Room closed by owner");
      window.location.reload();
    });
  </script>
</body>
</html>
