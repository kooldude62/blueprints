<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Room Join System</title>
  <script src="/socket.io/socket.io.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background: #111; color: #eee; text-align: center; padding: 40px; }
    input, button { padding: 10px; margin: 5px; border-radius: 6px; border: none; }
    button { background: #28a745; color: white; cursor: pointer; }
    button:hover { background: #218838; }
    #roomInfo { margin-top: 20px; padding: 15px; background: #222; border-radius: 8px; }
    .player-box { display: inline-block; margin: 10px; padding: 10px; border-radius: 6px; background: #333; }
    .kick-btn { background: #dc3545; margin-left: 10px; }
    .kick-btn:hover { background: #c82333; }
  </style>
</head>
<body>
  <h1>Room System</h1>

  <div>
    <input id="ownerName" placeholder="Enter Your Name" />
    <button onclick="createRoom()">Create Room (Owner)</button>
  </div>

  <div style="margin-top:20px;">
    <input id="joinCode" placeholder="Enter Join Code" />
    <input id="playerName" placeholder="Enter Name" />
    <button onclick="joinRoom()">Join Room</button>
  </div>

  <div id="roomInfo"></div>

  <script>
    const socket = io();
    let currentRoom = null;
    let isOwner = false;
    let myId = null;
    let ownerId = null;

    async function createRoom() {
      const playerName = document.getElementById("ownerName").value.trim();
      if (!playerName) return alert("Enter your name!");

      const res = await fetch("/create", { method: "POST" });
      const data = await res.json();
      currentRoom = data.joinCode;
      isOwner = true;

      document.getElementById("roomInfo").innerHTML =
        `<h3>Room Created</h3><p>Join Code: <b>${data.joinCode}</b></p>`;

      socket.emit("joinRoom", { code: currentRoom, playerName, isOwner: true });
    }

    async function joinRoom() {
      const code = document.getElementById("joinCode").value.trim().toUpperCase();
      const playerName = document.getElementById("playerName").value.trim();
      if (!code || !playerName) return alert("Enter join code and name!");

      const res = await fetch("/join", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ code })
      });

      if (res.status !== 200) {
        alert("Room not found!");
        return;
      }

      currentRoom = code;
      socket.emit("joinRoom", { code, playerName, isOwner: false });
    }

    socket.on("connect", () => {
      myId = socket.id;
    });

    socket.on("playerList", (data) => {
      ownerId = data.owner;
      const roomDiv = document.getElementById("roomInfo");
      roomDiv.innerHTML = `<h3>Room: ${currentRoom}</h3>`;

      data.players.forEach(player => {
        let playerBox = `<div class="player-box">${player.name}`;
        if (isOwner && player.id !== ownerId) {
          playerBox += ` <button class="kick-btn" onclick="kickPlayer('${player.id}')">Kick</button>`;
        }
        if (player.id === ownerId) {
          playerBox += " (Owner)";
        }
        playerBox += "</div>";
        roomDiv.innerHTML += playerBox;
      });
    });

    socket.on("errorMsg", (msg) => alert(msg));

    socket.on("kicked", () => {
      alert("You were kicked from the room!");
      location.reload();
    });

    function kickPlayer(targetId) {
      socket.emit("kickPlayer", { code: currentRoom, targetId });
    }
  </script>
</body>
</html>
